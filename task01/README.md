Solution:

Taken from Linux Device Drivers, 3rd ed, [Chapter 2.](https://static.lwn.net/images/pdf/LDD3/ch02.pdf)